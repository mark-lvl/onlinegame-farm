jQuery.fn.BoxyFarm=function(d){d=d||{};return this.each(function(){var c=this.nodeName.toLowerCase(),self=this;if(c=='a'){jQuery(this).click(function(){var a=BoxyFarm.linkedTo(this),href=this.getAttribute('href'),localOptions=jQuery.extend({actuator:this,title:this.title},d);if(a){a.show()}else if(href.indexOf('#')>=0){var b=jQuery(href.substr(href.indexOf('#'))),newContent=b.clone(true);b.remove();localOptions.unloadOnHide=false;new BoxyFarm(newContent,localOptions)}else{if(!localOptions.cache)localOptions.unloadOnHide=true;BoxyFarm.load(this.href,localOptions)}return false})}else if(c=='form'){jQuery(this).bind('submit.BoxyFarm',function(){BoxyFarm.confirm(d.message||'Please confirm:',function(){jQuery(self).unbind('submit.BoxyFarm').submit()});return false})}})};function BoxyFarm(a,b){this.BoxyFarm=jQuery(BoxyFarm.WRAPPER);jQuery.data(this.BoxyFarm[0],'boxyFarm',this);this.visible=false;this.options=jQuery.extend({},BoxyFarm.DEFAULTS,b||{});if(this.options.modal){this.options=jQuery.extend(this.options,{center:true,draggable:false})}if(this.options.actuator){jQuery.data(this.options.actuator,'active.BoxyFarm',this)}this.setContent(a||"<div></div>");this._setupTitleBar();this.BoxyFarm.css('display','none').appendTo(document.body);this.toTop();if(this.options.fixed){if(jQuery.browser.msie&&jQuery.browser.version<7){this.options.fixed=false}else{this.BoxyFarm.addClass('fixed')}}if(this.options.center&&BoxyFarm._u(this.options.x,this.options.y)){this.center()}else{this.moveTo(BoxyFarm._u(this.options.x)?this.options.x:BoxyFarm.DEFAULT_X,BoxyFarm._u(this.options.y)?this.options.y:BoxyFarm.DEFAULT_Y)}if(this.options.show)this.show()}BoxyFarm.EF=function(){};jQuery.extend(BoxyFarm,{WRAPPER:"<div class='boxy-wrapperFarm'>"+"<div class='boxy-innerFarm'><div class='main-contentFarm'></div></div>"+"<div class='boxy-footerFarm'></div>"+"</div>",DEFAULTS:{title:null,closeable:true,draggable:true,clone:false,actuator:null,center:true,show:true,modal:false,fixed:true,closeText:'[close]',unloadOnHide:true,clickToFront:false,behaviours:BoxyFarm.EF,afterDrop:BoxyFarm.EF,afterShow:BoxyFarm.EF,afterHide:BoxyFarm.EF,beforeUnload:BoxyFarm.EF},DEFAULT_X:50,DEFAULT_Y:50,zIndex:1337,dragConfigured:false,resizeConfigured:false,dragging:null,load:function(b,c){c=c||{};var d={url:b,type:'GET',dataType:'html',cache:false,success:function(a){a=jQuery(a);if(c.filter)a=jQuery(c.filter,a);new BoxyFarm(a,c)}};jQuery.each(['type','cache'],function(){if(this in c){d[this]=c[this];delete c[this]}});jQuery.ajax(d)},get:function(a){var p=jQuery(a).parents('.boxy-wrapperFarm');return p.length?jQuery.data(p[0],'boxyFarm'):null},linkedTo:function(a){return jQuery.data(a,'active.BoxyFarm')},alert:function(a,b,c){return BoxyFarm.ask(a,['قبول'],b,c)},confirm:function(b,c,d){return BoxyFarm.ask(b,['قبول','رد کردن'],function(a){if(a=='قبول')c()},d)},ask:function(b,c,d,e){e=jQuery.extend({modal:true,closeable:false},e||{},{show:true,unloadOnHide:true});var f=jQuery('<div></div>').append(jQuery('<div class="question"></div>').html(b));var g={},answerStrings=[];if(c instanceof Array){for(var i=0;i<c.length;i++){g[c[i]]=c[i];answerStrings.push(c[i])}}else{for(var k in c){g[c[k]]=k;answerStrings.push(c[k])}}var h=jQuery('<form class="answers"></form>');h.html(jQuery.map(answerStrings,function(v){return"<input type='button' value='"+v+"' />"}).join(' '));jQuery('input[type=button]',h).click(function(){var a=this;BoxyFarm.get(this).hide(function(){if(d)d(g[a.value])})});f.append(h);new BoxyFarm(f,e)},isModalVisible:function(){return jQuery('.boxy-modal-blackoutFarm').length>0},_u:function(){for(var i=0;i<arguments.length;i++)if(typeof arguments[i]!='undefined')return false;return true},_handleResize:function(a){var d=jQuery(document);jQuery('.boxy-modal-blackoutFarm').css('display','none').css({width:d.width(),height:d.height()}).css('display','block')},_handleDrag:function(a){var d;if(d==BoxyFarm.dragging){d[0].BoxyFarm.css({left:a.pageX-d[1],top:a.pageY-d[2]})}},_nextZ:function(){return BoxyFarm.zIndex++},_viewport:function(){var d=document.documentElement,b=document.body,w=window;return jQuery.extend(jQuery.browser.msie?{left:b.scrollLeft||d.scrollLeft,top:b.scrollTop||d.scrollTop}:{left:w.pageXOffset,top:w.pageYOffset},!BoxyFarm._u(w.innerWidth)?{width:w.innerWidth,height:w.innerHeight}:(!BoxyFarm._u(d)&&!BoxyFarm._u(d.clientWidth)&&d.clientWidth!=0?{width:d.clientWidth,height:d.clientHeight}:{width:b.clientWidth,height:b.clientHeight}))}});BoxyFarm.prototype={estimateSize:function(){this.BoxyFarm.css({visibility:'hidden',display:'block'});var a=this.getSize();this.BoxyFarm.css('display','none').css('visibility','visible');return a},getSize:function(){return[this.BoxyFarm.width(),this.BoxyFarm.height()]},getContentSize:function(){var c=this.getContent();return[c.width(),c.height()]},getPosition:function(){var b=this.BoxyFarm[0];return[b.offsetLeft,b.offsetTop]},getCenter:function(){var p=this.getPosition();var s=this.getSize();return[Math.floor(p[0]+s[0]/2),Math.floor(p[1]+s[1]/2)]},getInner:function(){return jQuery('.main-contentFarm',this.BoxyFarm)},getContent:function(){return jQuery('.boxy-contentFarm',this.BoxyFarm)},setContent:function(a){a=jQuery(a).css({display:'block'}).addClass('boxy-contentFarm');if(this.options.clone)a=a.clone(true);this.getContent().remove();this.getInner().append(a);this._setupDefaultBehaviours(a);this.options.behaviours.call(this,a);return this},moveTo:function(x,y){this.moveToX(x).moveToY(y);return this},moveToX:function(x){if(typeof x=='number')this.BoxyFarm.css({left:x});else this.centerX();return this},moveToY:function(y){if(typeof y=='number')this.BoxyFarm.css({top:y});else this.centerY();return this},centerAt:function(x,y){var s=this[this.visible?'getSize':'estimateSize']();if(typeof x=='number'){this.moveToX(x-s[0]/2)}if(typeof y=='number'){this.moveToY(y)}return this},centerAtX:function(x){return this.centerAt(x,null)},centerAtY:function(y){return this.centerAt(null,y)},center:function(a){var v=BoxyFarm._viewport();var o=this.options.fixed?[0,0]:[v.left,v.top];if(!a||a=='x')this.centerAt(o[0]+v.width/2,null);if(!a||a=='y')this.centerAt(null,o[1]+v.height/2);return this},centerX:function(){return this.center('x')},centerY:function(){return this.center('y')},resize:function(a,b,c){if(!this.visible)return;var d=this._getBoundsForResize(a,b);this.BoxyFarm.css({left:d[0],top:d[1]});this.getContent().css({width:d[2],height:d[3]});if(c)c(this);return this},tween:function(a,b,c){if(!this.visible)return;var d=this._getBoundsForResize(a,b);var e=this;this.BoxyFarm.stop().animate({left:d[0],top:d[1]});this.getContent().stop().animate({width:d[2],height:d[3]},function(){if(c)c(e)});return this},isVisible:function(){return this.visible},show:function(){if(this.visible)return;if(this.options.modal){var c=this;if(!BoxyFarm.resizeConfigured){BoxyFarm.resizeConfigured=true;jQuery(window).resize(function(){BoxyFarm._handleResize()})}this.modalBlackout=jQuery('<div class="boxy-modal-blackoutFarm"></div>').css({zIndex:BoxyFarm._nextZ(),opacity:0.7,width:jQuery(document).width(),height:jQuery(document).height()}).appendTo(document.body);this.toTop();if(this.options.closeable){jQuery(document.body).bind('keypress.BoxyFarm',function(a){var b=a.which||a.keyCode;if(b==27){c.hide();jQuery(document.body).unbind('keypress.BoxyFarm')}})}}this.BoxyFarm.stop().css({opacity:1}).show();this.visible=true;this._fire('afterShow');return this},hide:function(a){if(!this.visible)return;var b=this;if(this.options.modal){jQuery(document.body).unbind('keypress.BoxyFarm');this.modalBlackout.animate({opacity:0},function(){jQuery(this).remove()})}this.BoxyFarm.stop().animate({opacity:0},300,function(){b.BoxyFarm.css({display:'none'});b.visible=false;b._fire('afterHide');if(a)a(b);if(b.options.unloadOnHide)b.unload()});return this},toggle:function(){this[this.visible?'hide':'show']();return this},hideAndUnload:function(a){this.options.unloadOnHide=true;this.hide(a);return this},unload:function(){this._fire('beforeUnload');this.BoxyFarm.remove();if(this.options.actuator){jQuery.data(this.options.actuator,'active.BoxyFarm',false)}},toTop:function(){this.BoxyFarm.css({zIndex:BoxyFarm._nextZ()});return this},getTitle:function(){return jQuery('> .title-bar h2',this.getInner()).html()},setTitle:function(t){jQuery('> .title-bar h2',this.getInner()).html(t);return this},_getBoundsForResize:function(a,b){var c=this.getContentSize();var d=[a-c[0],b-c[1]];var p=this.getPosition();return[Math.max(p[0]-d[0]/2,0),Math.max(p[1]-d[1]/2,0),a,b]},_setupTitleBar:function(){if(this.options.title){var b=this;var c=jQuery("<div class='title-bar'></div>").html("<h2>"+this.options.title+"</h2>");if(this.options.closeable){c.append(jQuery("<a href='#' class='close'></a>").html(this.options.closeText))}if(this.options.draggable){c[0].onselectstart=function(){return false};c[0].unselectable='on';c[0].style.MozUserSelect='none';if(!BoxyFarm.dragConfigured){jQuery(document).mousemove(BoxyFarm._handleDrag);BoxyFarm.dragConfigured=true}c.mousedown(function(a){b.toTop();BoxyFarm.dragging=[b,a.pageX-b.BoxyFarm[0].offsetLeft,a.pageY-b.BoxyFarm[0].offsetTop];jQuery(this).addClass('dragging')}).mouseup(function(){jQuery(this).removeClass('dragging');BoxyFarm.dragging=null;b._fire('afterDrop')})}this.getInner().parent().parent().prepend(c);this._setupDefaultBehaviours(c)}},_setupDefaultBehaviours:function(b){var c=this;if(this.options.clickToFront){b.click(function(){c.toTop()})}jQuery('.close',b).click(function(){c.hide();return false}).mousedown(function(a){a.stopPropagation()})},_fire:function(a){this.options[a].call(this)}};